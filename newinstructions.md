

**请将以下 Prompt 交给你的编程助手，让他执行文件拆分和 ID 格式化的任务：**

````text
你好！我们正在处理一个名为 `rag_input.jsonl` 的文件，用于为 LightRAG 知识库提供输入数据。该文件目前以 JSON Lines 格式存储，每行包含一个 `doc_id` (例如 `"character_1102"`) 和一个 `text` 字段。`text` 字段内包含了某个实体（如角色）相关的多个子主题文本，通常由 `标题:` 字符串分隔。

**当前格式示例 (`rag_input.jsonl` 中的一行):**
```json
{"doc_id": "character_1102", "text": "角色名称: 散华\\n称号: 雪舞芳华\\n\\n-----角色资料-----...\\n\\n-----角色故事-----\\n标题: 令尹近卫之名\\n比起“散华”...\\n\\n标题: 生日祝福\\n你的生日？...\\n\\n标题: 关于今汐\\n每当银白的雪花..."}
````

**问题:** 当前的格式粒度太粗，不利于 LightRAG 进行精确的增量更新（基于内容哈希）和检索。当 `text` 字段中的一小部分内容更新时，会导致整个大块文本被视为已更改。

**任务:** 请编写一个 Python 脚本，读取 `rag_input.jsonl` 文件，并将其**拆分**成更细粒度的记录，输出到一个**新的** JSON Lines 文件 (例如 `rag_input_split.jsonl`)。

**新文件 (`rag_input_split.jsonl`) 的格式要求:**

1.  **每一行**仍然是一个 JSON 对象，包含 `doc_id` 和 `text` 字段。
2.  **拆分逻辑:**
      * 原始 `text` 字段中，以 `标题:` 开头的部分应被视为独立的**逻辑子主题**。
      * 角色名称、称号、角色资料等**前导信息**可以考虑作为单独的记录，或根据需要附加到第一个主要子主题记录中（请判断哪种方式更利于检索）。
      * 每个逻辑子主题（包括其标题和对应的文本内容）应成为新文件中的**一条独立记录**。
3.  **`doc_id` 格式化:**
      * 新的 `doc_id` 必须是**稳定且有意义的**，能唯一标识这个逻辑子主题，并且在游戏版本更新时尽可能保持不变。
      * **推荐格式:** `<类型>_<主要实体名称>_<子主题标识符>`。
          * `<类型>`: 从原始 `doc_id` (如 "character\_1102") 中提取 "character"。如果是其他类型（未来可能有 "weapon", "item", "quest" 等），也照此提取。
          * `<主要实体名称>`: **需要识别出主要实体**。对于 "character\_1102"，我们需要知道它对应的是 "散华"。可能需要一个映射表（例如 `{ "1102": "散华", "1104": "桃祈" }`），或者尝试从 `角色名称:` 字段提取。**请优先使用中文名称**，如果名称包含特殊字符，需要进行适当的 URL 编码或替换，确保 ID 的有效性。
          * `<子主题标识符>`: 使用 `标题:` 后面的文本作为标识符。同样，需要处理特殊字符，确保 ID 有效且易于理解。例如，“令尹近卫之名”、“生日祝福”、“关于今汐”。
4.  **`text` 字段内容:** 新记录的 `text` 字段应包含该逻辑子主题的**完整内容**（包括原始的 `标题:` 和后面的文本）。

**新格式示例 (基于上面的例子拆分后):**

```json
{"doc_id": "character_散华_资料", "text": "角色名称: 散华\\n称号: 雪舞芳华\\n\\n-----角色资料-----隶属于今州边庭的令尹近卫，散华。曾是带来灾难、可洞穿世间万物的修罗，如今将肆虐风雪化为守护的力量，成为了寡言的守护者。"}
{"doc_id": "character_散华_令尹近卫之名", "text": "标题: 令尹近卫之名\\n比起“散华”，他人对她更为常用的称呼是“那位令尹近卫”。..."}
{"doc_id": "character_散华_生日祝福", "text": "标题: 生日祝福\\n你的生日？今天？哦。..."}
{"doc_id": "character_散华_关于今汐", "text": "标题: 关于今汐\\n每当银白的雪花装点天城..."}
```

*(注意：上面的 `character_散华_资料` 是一个示例，具体如何处理前导信息可以讨论决定)*

**脚本要求:**

  * 健壮性：能够处理 `rag_input.jsonl` 中可能存在的格式异常。
  * 可配置性（加分项）：允许传入角色 ID 到名称的映射文件路径。
  * 清晰性：代码逻辑清晰，易于理解和维护。

这个脚本将是 `LightRAG` 数据处理流水线中的关键一环，确保我们能高效地进行增量更新。谢谢！

```
